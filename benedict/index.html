<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benedict - joeldelaney</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #benedict-map {
            height: 500px;
            width: 100%;
            margin: 30px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .benedict-list {
            margin-top: 40px;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <div class="brand">
                <a href="/"><h1>joeldelaney</h1></a>
            </div>
            <ul class="nav-links">
                <li><a href="/">Home</a></li>
                <li><a href="/blog/">Blog</a></li>
                <li><a href="/work/">Work</a></li>
                <li><a href="/benedict/" class="active">Benedict</a></li>
                <li><a href="/book/">Book</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div style="max-width: 800px; margin: 0 auto 30px auto; padding: 0 20px;">
            <h1 style="text-align: center; color: #ffffff; font-size: 2.5rem; margin-bottom: 30px;">EBI</h1>
            <p style="color: #b0d4dd; line-height: 1.7; text-align: justify; margin-bottom: 1rem;">
                The Eggs Benedict Index (EBI) - compiled by the Benedict Fellowship - is designed to help you, wherever you are in the world, find the best place to go for breakfast. It is our contention that every place serving breakfast, should have to serve Eggs Benedict, so that they can be properly ranked.
            </p>
            <p style="color: #b0d4dd; line-height: 1.7; text-align: justify;">
                Why, you ask? Simple, because when done right, there's nothing better. When done wrong, it's near-unforgiveable. The 4-egg and 5-egg locations in this list, feel free to buy whatever is on the menu. These places have demonstrated that most illusive and vital trait present in all great breakfasts - balance. Enjoy.
            </p>
        </div>

        <div id="benedict-map"></div>

        <div class="benedict-list" id="reviews-container">
            <!-- Reviews are automatically loaded from benedict-reviews.js -->
        </div>
    </main>

    <footer>
        <p>&copy; 2025 Joel Delaney</p>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/benedict-reviews.js"></script>
    <script>
        // Sort reviews by date (newest first)
        const sortedReviews = benedictReviews.sort((a, b) => new Date(b.date) - new Date(a.date));

        // Group reviews by location (lat/lng)
        const locationGroups = {};
        sortedReviews.forEach(review => {
            const key = `${review.lat},${review.lng}`;
            if (!locationGroups[key]) {
                locationGroups[key] = {
                    lat: review.lat,
                    lng: review.lng,
                    reviews: []
                };
            }
            locationGroups[key].reviews.push(review);
        });

        // Initialize map
        const map = L.map('benedict-map').setView([51.505, -0.09], 6);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Add markers for each location
        const locationGroupsArray = Object.values(locationGroups);
        if (locationGroupsArray.length > 0) {
            const bounds = [];
            locationGroupsArray.forEach(locGroup => {
                const marker = L.marker([locGroup.lat, locGroup.lng]).addTo(map);

                // Build popup content with all reviews at this location
                let popupContent = '';
                if (locGroup.reviews.length === 1) {
                    const review = locGroup.reviews[0];
                    const eggs = 'üç≥'.repeat(review.rating);
                    popupContent = `<strong>${review.title}</strong><br>${eggs}<br><em>${review.fellow}</em><br><a href="${review.url}">Read Review</a>`;
                } else {
                    popupContent = '<strong>Reviews at this location:</strong><br><br>';
                    locGroup.reviews.forEach(review => {
                        const eggs = 'üç≥'.repeat(review.rating);
                        popupContent += `<a href="${review.url}">${review.title}</a> ${eggs}<br><em>${review.fellow}</em><br>`;
                    });
                }

                marker.bindPopup(popupContent);
                bounds.push([locGroup.lat, locGroup.lng]);
            });
            // Fit map to show all markers
            if (bounds.length === 1) {
                map.setView(bounds[0], 13);
            } else {
                map.fitBounds(bounds);
            }
        }

        // Populate reviews list (already sorted newest first)
        const reviewsContainer = document.getElementById('reviews-container');
        sortedReviews.forEach(review => {
            const article = document.createElement('article');
            article.className = 'benedict-review';

            const eggIcons = 'üç≥'.repeat(review.rating);

            article.innerHTML = `
                <h2><a href="${review.url}">${review.title}</a></h2>
                <div class="benedict-rating">${eggIcons}</div>
                <div style="color: #b0d4dd; font-style: italic; margin-top: 5px;">${review.fellow}</div>
                <time datetime="${review.date}">${review.dateDisplay}</time>
                <p>${review.summary}</p>
            `;

            reviewsContainer.appendChild(article);
        });
    </script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FRT76XL460"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FRT76XL460');
    </script>
</body>
</html>
